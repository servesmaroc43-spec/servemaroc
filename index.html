<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SERVE MAROC | دخول وتسجيل</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
        body { font-family: 'Tajawal', sans-serif; background: #f3f4f6; min-height: 100vh; display: flex; align-items: center; justify-content: center; margin: 0; }
        .card { background: white; padding: 2.5rem; border-radius: 1.5rem; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); width: 100%; max-width: 420px; }
        .input-group input { width: 100%; padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.75rem; outline: none; text-align: right; }
        #msg { display: none; text-align: center; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 14px; }
    </style>
</head>
<body>

    <div class="card">
        <h1 class="text-3xl font-extrabold text-center text-blue-600 mb-6">SERVE MAROC</h1>
        <div id="msg"></div>

        <div class="space-y-4">
            <div id="name-box" class="input-group hidden">
                <input id="u-name" type="text" placeholder="الاسم الكامل">
            </div>
            <div class="input-group">
                <input id="u-email" type="email" placeholder="البريد الإلكتروني">
            </div>
            <div class="input-group">
                <input id="u-pass" type="password" placeholder="كلمة المرور">
            </div>
            <button onclick="handleSubmit()" id="main-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 transition">دخول</button>
        </div>

        <div class="mt-6 text-center text-sm">
            <p id="toggle-text">ليس لديك حساب؟ <span onclick="toggleMode()" class="text-blue-600 font-bold cursor-pointer">أنشئ حساباً</span></p>
        </div>
    </div>

    <script>
        // الرابط الخاص بك الذي نسخته
        const scriptURL = "https://script.google.com/macros/s/AKfycbydUIEV-s7RsqJAVgGvODciYAr1rZetC1NOMTEYKHRAFhkZ-vgrFgrXis4ii-BiVwig/exec"; 

        let isLoginMode = true;

        // ميزة "يعقل": الدخول التلقائي
        window.onload = function() {
            const saved = localStorage.getItem("userSession");
            if (saved) {
                const user = JSON.parse(saved);
                performAction("login", user);
            }
        };

        function toggleMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('name-box').classList.toggle('hidden');
            document.getElementById('main-btn').innerText = isLoginMode ? "دخول" : "تسجيل جديد";
        }

        function handleSubmit() {
            const data = {
                name: document.getElementById('u-name').value,
                email: document.getElementById('u-email').value,
                pass: document.getElementById('u-pass').value
            };
            performAction(isLoginMode ? "login" : "signup", data);
        }

        function performAction(action, data) {
            const url = action === "login" ? `${scriptURL}?email=${data.email}&pass=${data.pass}` : scriptURL;
            const options = action === "signup" ? { method: "POST", body: JSON.stringify(data) } : {};

            fetch(url, options)
            .then(res => action === "login" ? res.json() : res.text())
            .then(resData => {
                if(action === "login" && resData.status === "success") {
                    localStorage.setItem("userSession", JSON.stringify(data));
                    window.location.href = "https://www.google.com";
                } else if(action === "signup") {
                    alert("تم إنشاء الحساب! يمكنك الدخول الآن");
                    toggleMode();
                } else {
                    alert("خطأ في البيانات");
                }
            })
            .catch(() => alert("تأكد من اختيار 'الجميع' عند النشر في جوجل"));
        }
    </script>
</body>
</html>
