<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SERVE MAROC | ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">

    <style>
        body { 
            font-family: 'Tajawal', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 20px;
        }
        .main-card { 
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 420px;
            padding: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .logo-area { 
            font-size: 32px; 
            font-weight: 800; 
            text-align: center; 
            margin-bottom: 35px;
            background: linear-gradient(90deg, #2563eb, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }
        
        .tabs-container { 
            position: relative; 
            display: flex; 
            background: #f1f5f9;
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        .tab-item { 
            flex: 1; 
            text-align: center; 
            padding: 12px 5px; 
            cursor: pointer; 
            font-weight: 700; 
            color: #64748b;
            border-radius: 8px;
            transition: all 0.3s ease;
            z-index: 2;
            font-size: 15px;
        }
        .tab-item.active { 
            color: white;
            background: #2563eb;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        
        .input-box { 
            width: 100%; 
            padding: 16px 20px; 
            background: white; 
            border-radius: 12px; 
            border: 2px solid #e2e8f0; 
            outline: none; 
            text-align: right; 
            margin-bottom: 18px;
            font-size: 15px;
            transition: all 0.3s;
        }
        .input-box:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .action-btn { 
            width: 100%; 
            padding: 17px; 
            background: linear-gradient(90deg, #2563eb, #4f46e5);
            color: white; 
            border-radius: 12px; 
            font-weight: 700; 
            border: none; 
            cursor: pointer; 
            font-size: 16px;
            margin-top: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
        }
        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .hidden { display: none; }
        
        #alert-box { 
            position: fixed; 
            top: 25px; 
            left: 50%; 
            transform: translateX(-50%);
            background: linear-gradient(90deg, #1e293b, #334155);
            color: white; 
            padding: 14px 28px; 
            border-radius: 12px; 
            display: none; 
            z-index: 1000; 
            font-size: 14.5px;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            border-left: 4px solid #2563eb;
            min-width: 300px;
            text-align: center;
        }
        
        .forgot-link {
            color: #2563eb;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: color 0.3s;
        }
        .forgot-link:hover {
            color: #1d4ed8;
            text-decoration: underline;
        }
        
        .back-link {
            color: #64748b;
            font-size: 13.5px;
            cursor: pointer;
            margin-top: 20px;
            display: inline-block;
        }
        
        .otp-input {
            font-size: 32px;
            letter-spacing: 10px;
            font-weight: 800;
            color: #1e293b;
            text-align: center;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .password-container {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="alert-box"></div>

    <div class="main-card">
        <div class="logo-area">SERVE<span style="color: #2563eb">MAROC</span></div>
        
        <div id="tabs-nav" class="tabs-container">
            <div id="t-login" onclick="nav('login')" class="tab-item active">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
            <div id="t-reg" onclick="nav('reg')" class="tab-item">Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</div>
        </div>

        <!-- Ù‚Ø³Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div id="sec-login">
            <input id="l_email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="input-box" autocomplete="email">
            <div class="password-container">
                <input id="l_pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="input-box" autocomplete="current-password">
                <button type="button" class="toggle-password" onclick="togglePassword('l_pass')">ğŸ‘ï¸</button>
            </div>
            <div class="text-left mb-6">
                <span onclick="nav('reset')" class="forgot-link">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</span>
            </div>
            <button onclick="App.login()" class="action-btn" id="login-btn">
                <span id="login-text">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
                <span id="login-loading" class="hidden loading"></span>
            </button>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
        <div id="sec-reg" class="hidden">
            <input id="r_name" type="text" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" class="input-box" autocomplete="name">
            <input id="r_email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="input-box" autocomplete="email">
            <div class="password-container">
                <input id="r_pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)" class="input-box" autocomplete="new-password">
                <button type="button" class="toggle-password" onclick="togglePassword('r_pass')">ğŸ‘ï¸</button>
            </div>
            <button onclick="App.signup()" class="action-btn" id="signup-btn">
                <span id="signup-text">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</span>
                <span id="signup-loading" class="hidden loading"></span>
            </button>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
        <div id="sec-reset" class="hidden text-center">
            <p class="text-sm font-bold text-slate-700 mb-6">Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p>
            <input id="reset_email" type="email" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="input-box" autocomplete="email">
            <button onclick="App.forgotPass()" class="action-btn" id="reset-btn">
                <span id="reset-text">Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚</span>
                <span id="reset-loading" class="hidden loading"></span>
            </button>
            <p onclick="nav('login')" class="back-link">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨ÙƒÙˆØ¯ OTP -->
        <div id="sec-otp" class="hidden text-center">
            <p id="otp-title" class="text-sm font-bold text-slate-700 mb-8">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø±Ø³Ù„ Ù„Ø¨Ø±ÙŠØ¯Ùƒ</p>
            <input id="otp_val" type="text" maxlength="6" inputmode="numeric" pattern="\d*" 
                   class="w-full p-5 text-center otp-input bg-slate-50 border-2 border-slate-200 rounded-xl mb-6"
                   placeholder="123456">
            <div id="new_pass_area" class="hidden">
                <div class="password-container">
                    <input id="new_pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" class="input-box" autocomplete="new-password">
                    <button type="button" class="toggle-password" onclick="togglePassword('new_pass')">ğŸ‘ï¸</button>
                </div>
            </div>
            <button onclick="App.verify()" class="action-btn" id="verify-btn">
                <span id="verify-text">ØªØ£ÙƒÙŠØ¯</span>
                <span id="verify-loading" class="hidden loading"></span>
            </button>
            <p onclick="nav('login')" class="back-link mt-4">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</p>
        </div>
    </div>

    <script>
// Ø±Ø§Ø¨Ø· Google Apps Script Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ - Ø¶Ø¹ Ø±Ø§Ø¨Ø·Ùƒ Ù‡Ù†Ø§
const apiURL = "https://script.google.com/macros/s/AKfycbwN3cwCF4iDZhdCsiA_z7wCkR0n-xr1sNrLStSpcPFl8saoO2vaEZ0-2w8FKm5BK5-1/exec";

let isLoading = false;

function showMsg(msg, type = "info") {
    const box = document.getElementById("alert-box");
    box.innerText = msg;
    
    // Ø£Ù„ÙˆØ§Ù† Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    if(type === "success") {
        box.style.background = "linear-gradient(90deg, #10b981, #34d399)";
        box.style.borderLeftColor = "#10b981";
    } else if(type === "error") {
        box.style.background = "linear-gradient(90deg, #ef4444, #f87171)";
        box.style.borderLeftColor = "#ef4444";
    } else {
        box.style.background = "linear-gradient(90deg, #1e293b, #334155)";
        box.style.borderLeftColor = "#2563eb";
    }
    
    box.style.display = "block";
    setTimeout(() => box.style.display = "none", 3000);
}

function showLoading(buttonId) {
    const btn = document.getElementById(buttonId);
    const textSpan = btn.querySelector("[id$='-text']");
    const loadingSpan = btn.querySelector("[id$='-loading']");
    
    if(textSpan && loadingSpan) {
        textSpan.classList.add("hidden");
        loadingSpan.classList.remove("hidden");
        btn.disabled = true;
        isLoading = true;
    }
}

function hideLoading(buttonId) {
    const btn = document.getElementById(buttonId);
    const textSpan = btn.querySelector("[id$='-text']");
    const loadingSpan = btn.querySelector("[id$='-loading']");
    
    if(textSpan && loadingSpan) {
        textSpan.classList.remove("hidden");
        loadingSpan.classList.add("hidden");
        btn.disabled = false;
        isLoading = false;
    }
}

function nav(target) {
    if(isLoading) return;
    
    const sections = ["sec-login","sec-reg","sec-reset","sec-otp"];
    sections.forEach(id => {
        const el = document.getElementById(id);
        if(el) el.classList.add("hidden");
    });
    
    const targetEl = document.getElementById("sec-" + target);
    if(targetEl) targetEl.classList.remove("hidden");

    const tabs = document.getElementById("tabs-nav");
    if(tabs) {
        tabs.style.display = (target === "login" || target === "reg") ? "flex" : "none";
    }

    const tLogin = document.getElementById("t-login");
    const tReg = document.getElementById("t-reg");
    
    if(target === "login" && tLogin && tReg) {
        tLogin.classList.add("active");
        tReg.classList.remove("active");
    } else if(target === "reg" && tLogin && tReg) {
        tReg.classList.add("active");
        tLogin.classList.remove("active");
    }
    
    // ØªÙ†Ø¸ÙŠÙ Ø­Ù‚Ù„ OTP Ø¹Ù†Ø¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
    if(target !== "otp") {
        document.getElementById("otp_val").value = "";
    }
}

function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
    input.setAttribute('type', type);
}

const App = {
    otp: "",
    mode: "",
    draft: {},

    login() {
        if(isLoading) return;
        
        const email = document.getElementById("l_email").value.trim();
        const pass = document.getElementById("l_pass").value.trim();
        
        if(!email || !pass) {
            showMsg("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", "error");
            return;
        }
        
        if(!this.validateEmail(email)) {
            showMsg("Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­", "error");
            return;
        }
        
        showLoading("login-btn");
        showMsg("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...", "info");

        fetch(apiURL, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                action: "login",
                email: email,
                pass: pass
            })
        })
        .then(r => r.json())
        .then(data => {
            hideLoading("login-btn");
            
            if(data.status === "success") {
                showMsg("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!", "success");
                localStorage.setItem("userSession", JSON.stringify({
                    email: email,
                    name: data.user?.name || email.split('@')[0],
                    loginTime: new Date().toISOString()
                }));
                
                setTimeout(() => {
                    window.location.href = "w/index.html";
                }, 1500);
            } else {
                showMsg(data.message || "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©", "error");
            }
        })
        .catch(error => {
            hideLoading("login-btn");
            showMsg("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…", "error");
            console.error("Login error:", error);
        });
    },

    signup() {
        if(isLoading) return;
        
        this.mode = "register";
        this.draft = {
            name: document.getElementById("r_name").value.trim(),
            email: document.getElementById("r_email").value.trim(),
            pass: document.getElementById("r_pass").value.trim()
        };
        
        if(!this.draft.name || !this.draft.email || !this.draft.pass) {
            showMsg("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„", "error");
            return;
        }
        
        if(!this.validateEmail(this.draft.email)) {
            showMsg("Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­", "error");
            return;
        }
        
        if(this.draft.pass.length < 6) {
            showMsg("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", "error");
            return;
        }
        
        showLoading("signup-btn");
        this.sendOTP();
    },

    forgotPass() {
        if(isLoading) return;
        
        this.mode = "updatePass";
        this.draft = { 
            email: document.getElementById("reset_email").value.trim() 
        };
        
        if(!this.draft.email) {
            showMsg("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ", "error");
            return;
        }
        
        if(!this.validateEmail(this.draft.email)) {
            showMsg("Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­", "error");
            return;
        }
        
        showLoading("reset-btn");
        
        // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹
        fetch(apiURL, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                action: "checkEmail",
                email: this.draft.email
            })
        })
        .then(r => r.json())
        .then(data => {
            if(data.exists) {
                document.getElementById("new_pass_area").classList.remove("hidden");
                document.getElementById("otp-title").innerText = "Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©";
                this.sendOTP();
            } else {
                hideLoading("reset-btn");
                showMsg("Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„", "error");
            }
        })
        .catch(() => {
            hideLoading("reset-btn");
            showMsg("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚", "error");
        });
    },

    sendOTP() {
        // ØªÙˆÙ„ÙŠØ¯ OTP
        this.otp = Math.floor(100000 + Math.random() * 900000).toString();
        
        // ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬: Ø£Ø±Ø³Ù„ OTP Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙŠØ¯
        // Ù‡Ù†Ø§ Ù†Ø¹Ø±Ø¶Ù‡ ÙÙ‚Ø· Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        showMsg(`ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚: ${this.otp} (Ù„Ù„ØªØ¬Ø±Ø¨Ø© ÙÙ‚Ø·)`, "info");
        
        hideLoading(this.mode === "register" ? "signup-btn" : "reset-btn");
        nav("otp");
    },

    verify() {
        if(isLoading) return;
        
        const otpValue = document.getElementById("otp_val").value.trim();
        
        if(otpValue !== this.otp) {
            showMsg("ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­", "error");
            return;
        }
        
        if(this.mode === "updatePass") {
            this.draft.pass = document.getElementById("new_pass").value.trim();
            if(!this.draft.pass) {
                showMsg("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "error");
                return;
            }
            if(this.draft.pass.length < 6) {
                showMsg("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", "error");
                return;
            }
        }
        
        showLoading("verify-btn");
        this.save();
    },

    save() {
        fetch(apiURL, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ 
                action: this.mode, 
                ...this.draft 
            })
        })
        .then(r => r.json())
        .then(data => {
            hideLoading("verify-btn");
            
            if(data.status === "registered" || data.status === "updated") {
                showMsg(data.message || "ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!", "success");
                
                setTimeout(() => {
                    if(this.mode === "register") {
                        localStorage.setItem("userSession", JSON.stringify({
                            email: this.draft.email,
                            name: this.draft.name,
                            loginTime: new Date().toISOString()
                        }));
                        window.location.href = "w/index.html";
                    } else {
                        nav("login");
                    }
                }, 1500);
            } else {
                showMsg(data.message || "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸", "error");
            }
        })
        .catch(error => {
            hideLoading("verify-btn");
            showMsg("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„", "error");
            console.error("Save error:", error);
        });
    },

    validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
};

// ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
document.addEventListener("DOMContentLoaded", function() {
    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±
    document.querySelectorAll('.input-box').forEach(input => {
        input.addEventListener('keypress', function(e) {
            if(e.key === 'Enter') {
                const currentSection = document.querySelector('[id^="sec-"]:not(.hidden)').id;
                
                if(currentSection === 'sec-login') App.login();
                else if(currentSection === 'sec-reg') App.signup();
                else if(currentSection === 'sec-reset') App.forgotPass();
                else if(currentSection === 'sec-otp') App.verify();
            }
        });
    });
    
    // OTP Ø¥Ø¯Ø®Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
    const otpInput = document.getElementById('otp_val');
    if(otpInput) {
        otpInput.addEventListener('input', function() {
            if(this.value.length === 6) {
                App.verify();
            }
        });
    }
    
    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
    const savedSession = localStorage.getItem("userSession");
    if(savedSession) {
        try {
            const session = JSON.parse(savedSession);
            document.getElementById("l_email").value = session.email || "";
        } catch(e) {
            localStorage.removeItem("userSession");
        }
    }
    
    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    document.querySelectorAll('.toggle-password').forEach(btn => {
        btn.addEventListener('click', function() {
            const input = this.parentElement.querySelector('input');
            const type = input.type === 'password' ? 'text' : 'password';
            input.type = type;
            this.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
        });
    });
});
</script>
</body>
</html>
