<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SERVE MAROC | نظام الدخول الذكي</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

    <style>
        /* --- قسم التنسيقات (CSS) --- */
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f3f4f6;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .main-container {
            width: 100%;
            max-width: 450px;
            padding: 20px;
        }

        .auth-card {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            transition: transform 0.3s ease;
        }

        .auth-card:hover {
            transform: translateY(-5px);
        }

        .app-logo {
            font-size: 32px;
            font-weight: 800;
            text-align: center;
            margin-bottom: 10px;
            color: #2563eb;
            letter-spacing: -1px;
        }

        .app-subtitle {
            text-align: center;
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 35px;
        }

        .input-group {
            margin-bottom: 18px;
        }

        .input-group label {
            display: block;
            font-size: 13px;
            font-weight: 700;
            color: #374151;
            margin-bottom: 6px;
        }

        .custom-input {
            width: 100%;
            padding: 12px 15px;
            border: 1.5px solid #d1d5db;
            border-radius: 10px;
            outline: none;
            font-size: 15px;
            text-align: right;
            transition: all 0.3s ease;
        }

        .custom-input:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn-primary {
            width: 100%;
            padding: 14px;
            background-color: #2563eb;
            color: white;
            border-radius: 10px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            border: none;
            margin-top: 10px;
            transition: background 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        .btn-secondary {
            width: 100%;
            padding: 14px;
            background-color: #16a34a;
            color: white;
            border-radius: 10px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            border: none;
            margin-top: 10px;
            transition: background 0.3s ease;
        }

        .btn-secondary:hover {
            background-color: #15803d;
        }

        .switch-text {
            text-align: center;
            margin-top: 25px;
            font-size: 14px;
            color: #4b5563;
        }

        .switch-link {
            color: #2563eb;
            font-weight: 700;
            cursor: pointer;
            text-decoration: none;
        }

        .switch-link:hover {
            text-decoration: underline;
        }

        .hidden {
            display: none;
        }

        .status-message {
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 13px;
            margin-bottom: 20px;
            display: none;
        }

        /* --- نهاية التنسيقات --- */
    </style>
</head>
<body>

    <div class="main-container">
        <div class="auth-card">
            
            <div class="app-logo">SERVE MAROC</div>
            <div class="app-subtitle">نظام إدارة الحسابات المتقدم</div>

            <div id="status-box" class="status-message"></div>

            <div id="login-container">
                <h2 class="text-lg font-bold text-gray-800 mb-4">تسجيل الدخول</h2>
                
                <div class="input-group">
                    <label>البريد الإلكتروني</label>
                    <input type="email" id="login-email" class="custom-input" placeholder="example@mail.com">
                </div>

                <div class="input-group">
                    <label>كلمة المرور</label>
                    <input type="password" id="login-pass" class="custom-input" placeholder="••••••••">
                </div>

                <button onclick="executeLogin()" class="btn-primary">دخول للمنصة</button>
                
                <p class="switch-text">
                    ليس لديك حساب؟ 
                    <span class="switch-link" onclick="toggleInterface('register')">أنشئ حساباً جديداً</span>
                </p>
            </div>

            <div id="register-container" class="hidden">
                <h2 class="text-lg font-bold text-gray-800 mb-4">فتح حساب جديد</h2>
                
                <div class="input-group">
                    <label>الاسم الكامل</label>
                    <input type="text" id="reg-name" class="custom-input" placeholder="أدخل اسمك الكامل">
                </div>

                <div class="input-group">
                    <label>البريد الإلكتروني</label>
                    <input type="email" id="reg-email" class="custom-input" placeholder="example@mail.com">
                </div>

                <div class="input-group">
                    <label>كلمة المرور</label>
                    <input type="password" id="reg-pass" class="custom-input" placeholder="••••••••">
                </div>

                <button onclick="executeRegister()" class="btn-secondary">تأكيد التسجيل</button>
                
                <p class="switch-text">
                    لديك حساب بالفعل؟ 
                    <span class="switch-link" onclick="toggleInterface('login')">العودة للدخول</span>
                </p>
            </div>

        </div>
    </div>

    <script>
        /* --- قسم البرمجة (JavaScript) --- */

        // رابط الاتصال بجوجل (URL الـ Web App)
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzTB9_9V1bqrn4ZHv3ERsksHSNd4WsGFQVFaZOga_Qyk0OXUW8SmPDz5kNCNaJnsFhTIw/exec";

        // 1. وظيفة فحص الجلسة السابقة (يعقل على المستخدم)
        window.onload = function() {
            console.log("Checking for active session...");
            const savedData = localStorage.getItem("userSession");
            
            if (savedData) {
                const user = JSON.parse(savedData);
                updateStatus("جاري تذكر بياناتك والدخول تلقائياً...", "#dbeafe", "#1e40af");
                startValidation(user.email, user.pass, true);
            }
        };

        // 2. التبديل بين الواجهات
        function toggleInterface(mode) {
            const loginBox = document.getElementById('login-container');
            const registerBox = document.getElementById('register-container');
            
            if (mode === 'register') {
                loginBox.classList.add('hidden');
                registerBox.classList.remove('hidden');
            } else {
                registerBox.classList.add('hidden');
                loginBox.classList.remove('hidden');
            }
        }

        // 3. تحديث رسائل الحالة للمستخدم
        function updateStatus(text, bgColor, textColor) {
            const statusBox = document.getElementById('status-box');
            statusBox.innerText = text;
            statusBox.style.backgroundColor = bgColor;
            statusBox.style.color = textColor;
            statusBox.style.display = 'block';
        }

        // 4. تنفيذ الدخول اليدوي
        function executeLogin() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;

            if (!email || !pass) {
                alert("المرجو إدخال كافة البيانات");
                return;
            }

            updateStatus("جاري الاتصال بالسيرفر...", "#fef3c7", "#92400e");
            startValidation(email, pass, false);
        }

        // 5. التحقق من البيانات مع جوجل
        function startValidation(email, pass, isAutomatic) {
            const finalURL = `${WEB_APP_URL}?email=${email}&pass=${pass}`;

            fetch(finalURL)
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    // حفظ الجلسة في ذاكرة المتصفح
                    localStorage.setItem("userSession", JSON.stringify({ email, pass }));
                    window.location.href = "https://www.google.com";
                } else {
                    updateStatus("بيانات الدخول غير صحيحة", "#fee2e2", "#991b1b");
                    if (isAutomatic) localStorage.removeItem("userSession");
                }
            })
            .catch(error => {
                console.error("Error:", error);
                updateStatus("فشل الاتصال: تأكد من إعدادات النشر", "#fee2e2", "#991b1b");
            });
        }

        // 6. تنفيذ إنشاء حساب جديد
        function executeRegister() {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;

            if (!name || !email || !pass) {
                alert("جميع الخانات مطلوبة");
                return;
            }

            updateStatus("جاري إنشاء حسابك...", "#dcfce7", "#166534");

            const requestBody = {
                name: name,
                email: email,
                pass: pass
            };

            fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors', // لضمان الإرسال حتى مع قيود الـ CORS
                body: JSON.stringify(requestBody)
            })
            .then(() => {
                alert("تم إنشاء الحساب بنجاح! يمكنك الآن تسجيل الدخول.");
                toggleInterface('login');
                updateStatus("تم التسجيل! سجل دخولك الآن", "#dcfce7", "#166534");
            })
            .catch(error => {
                alert("حدث خطأ أثناء التسجيل");
                console.log(error);
            });
        }

        /* --- نهاية الكود البرمجي --- */
    </script>
</body>
</html>
